// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------- ENUMS -----------------

enum GameMode {
  QUESTION_PICK
  RAPID_FIRE
  AUDIO
  VISUAL
}

enum MediaType {
  NONE
  AUDIO
  VIDEO
}

// ----------------- MAIN MODELS -----------------

model GameSession {
  id             String   @id @default(cuid())
  eventName      String
  organizerName  String
  organizerImage String?
  createdAt      DateTime @default(now())

  teams  Team[]
  rounds Round[]
}

model Round {
  id                String   @id @default(cuid())
  name              String
  gameMode          GameMode
  pointsPerQuestion Int      @default(10)
  totalQuestions    Int? // optional, for QUESTION_PICK or timed modes
  durationInSeconds Int? // optional, for RAPID_FIRE
  createdAt         DateTime @default(now())

  gameSession   GameSession @relation(fields: [gameSessionId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  gameSessionId String

  questions      Question[]
  scoreHistories ScoreHistory[]
}

model Team {
  id            String      @id @default(cuid())
  name          String
  teamLogo      String?
  score         Int         @default(0)
  gameSession   GameSession @relation(fields: [gameSessionId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  gameSessionId String
  createdAt     DateTime    @default(now())

  scoreHistory ScoreHistory[]
}

model Question {
  id                 String    @id @default(cuid())
  questionText       String
  options            String[]
  correctOptionIndex Int
  mediaType          MediaType @default(NONE)
  mediaUrl           String? // URL or local path to media
  round              Round     @relation(fields: [roundId], references: [id], onDelete: Cascade)
  roundId            String
  createdAt          DateTime  @default(now())

  scoreHistory ScoreHistory[]
}

// ----------------- SCORE HISTORY -----------------

model ScoreHistory {
  id         String   @id @default(cuid())
  team       Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId     String
  round      Round    @relation(fields: [roundId], references: [id], onDelete: Cascade)
  roundId    String
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId String
  points     Int
  timestamp  DateTime @default(now())
}
